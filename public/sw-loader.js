// This script will extend the generated service worker with our custom functionality
if ('serviceWorker' in navigator) {
  window.addEventListener('load', async () => {
    try {
      // Register the main service worker (generated by Vite PWA plugin)
      const registration = await navigator.serviceWorker.register('/sw.js');
      console.log('Service worker registered successfully:', registration.scope);

      // Load our custom service worker code for push notifications
      await fetch('/custom-sw.js')
        .then(response => response.text())
        .then(async swCode => {
          // Add the custom code to the existing service worker
          await navigator.serviceWorker.ready;
          
          // This message will be received by our service worker
          navigator.serviceWorker.controller.postMessage({
            type: 'EXTEND_SW',
            code: swCode
          });
          
          console.log('Custom service worker functionality loaded');
        });
    } catch (error) {
      console.error('Service worker registration failed:', error);
    }
  });
}